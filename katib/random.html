<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Random Search - Hyperparameter tuning for TensorFlow using Katib and Kubeflow</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li><a href="../prereqs/prereqs.html"><strong aria-hidden="true">1.</strong> Setup Prerequisites</a></li><li><ol class="section"><li><a href="../prereqs/vagrant.html"><strong aria-hidden="true">1.1.</strong> Install Vagrant</a></li><li><a href="../prereqs/vb.html"><strong aria-hidden="true">1.2.</strong> Install Virtualbox</a></li><li><a href="../prereqs/download.html"><strong aria-hidden="true">1.3.</strong> Download Virtualbox VM</a></li></ol></li><li><a href="../kubernetes/setup.html"><strong aria-hidden="true">2.</strong> Setup Kubernetes</a></li><li><ol class="section"><li><a href="../kubernetes/k8s.html"><strong aria-hidden="true">2.1.</strong> Configure Persistent Storage</a></li><li><a href="../kubernetes/architecture.html"><strong aria-hidden="true">2.2.</strong> Kubernetes Architecture</a></li></ol></li><li><a href="../katib/katib.html"><strong aria-hidden="true">3.</strong> Katib</a></li><li><ol class="section"><li><a href="../katib/install.html"><strong aria-hidden="true">3.1.</strong> Installation</a></li><li><a href="../katib/hptuning.html"><strong aria-hidden="true">3.2.</strong> Hyperparameter Tuning</a></li><li><ol class="section"><li><a href="../katib/random.html" class="active"><strong aria-hidden="true">3.2.1.</strong> Random Search</a></li><li><a href="../katib/grid.html"><strong aria-hidden="true">3.2.2.</strong> Grid Search</a></li><li><a href="../katib/bayesian.html"><strong aria-hidden="true">3.2.3.</strong> Bayesian Optimization</a></li></ol></li><li><a href="../katib/automl.html"><strong aria-hidden="true">3.3.</strong> (Optional) AutoML Intuition</a></li></ol></li><li><a href="../kubeflow/kubeflow.html"><strong aria-hidden="true">4.</strong> Kubeflow</a></li><li><ol class="section"><li><a href="../kubeflow/install.html"><strong aria-hidden="true">4.1.</strong> Installation</a></li><li><a href="../kubeflow/pipelines.html"><strong aria-hidden="true">4.2.</strong> Pipelines</a></li></ol></li><li><a href="../cleanup/cleanup.html"><strong aria-hidden="true">5.</strong> Cleanup</a></li><li><a href="../references/index.html"><strong aria-hidden="true">6.</strong> References</a></li><li class="spacer"></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Hyperparameter tuning for TensorFlow using Katib and Kubeflow</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#random-search" id="random-search">Random Search</a></h1>
<p>Random search is a black box algorithm for searching for an optimal hyperparameter vector.
It assumes nothing about the model and trials can be run in parallel.</p>
<p>Random search selects points at random from the entire search space. </p>
<p><img src="../images/random.png" alt="Random" /></p>
<p>Random search provides a good coverage for multiple hyperparameters in the search space.
If you want a generic baseline, it is always a good idea to start with a Random search.</p>
<p>Now let us create a random search experiment using Katib.</p>
<h3><a class="header" href="#experiment" id="experiment">Experiment</a></h3>
<p>Let us start by creating an experiment.</p>
<details>
<summary>
Random search experiment
</summary>
<pre><code class="language-yaml">apiVersion: &quot;kubeflow.org/v1alpha3&quot;
kind: Experiment
metadata:
  namespace: kubeflow
  name: tfjob-random
spec:
  parallelTrialCount: 3
  maxTrialCount: 12
  maxFailedTrialCount: 3
  objective:
    type: maximize
    goal: 0.99
    objectiveMetricName: accuracy_1
  algorithm:
    algorithmName: random
  metricsCollectorSpec:
    source:
      fileSystemPath:
        path: /train
        kind: Directory
    collector:
      kind: TensorFlowEvent
  parameters:
    - name: --learning_rate
      parameterType: double
      feasibleSpace:
        min: &quot;0.01&quot;
        max: &quot;0.05&quot;
    - name: --batch_size
      parameterType: int
      feasibleSpace:
        min: &quot;100&quot;
        max: &quot;200&quot;
  trialTemplate:
    goTemplate:
        rawTemplate: |-
          apiVersion: &quot;kubeflow.org/v1&quot;
          kind: TFJob
          metadata:
            name: {{.Trial}}
            namespace: {{.NameSpace}}
          spec:
           tfReplicaSpecs:
            Worker:
              replicas: 1
              restartPolicy: OnFailure
              template:
                spec:
                  containers:
                    - name: tensorflow
                      image: gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0
                      imagePullPolicy: IfNotPresent
                      command:
                        - &quot;python&quot;
                        - &quot;/var/tf_mnist/mnist_with_summaries.py&quot;
                        - &quot;--log_dir=/train/metrics&quot;
                        {{- with .HyperParameters}}
                        {{- range .}}
                        - &quot;{{.Name}}={{.Value}}&quot;
                        {{- end}}
                        {{- end}}
</code></pre>
</details>
<p><img src="../images/experiment.png" alt="Experiment" /></p>
<pre><code class="language-console">cd $HOME/tutorial/examples/v1alpha3
kubectl apply -f tfjob-random.yaml
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
experiment.kubeflow.org/tfjob-random created
</details>
<p>Check that the <code>Experiment</code> <strong>tfjob-random</strong> has started.</p>
<pre><code class="language-console">kubectl -n kubeflow get experiment
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
NAME            STATUS    AGE
tfjob-random   Running   98s
</details>
<p>Check the details of the <code>Experiment</code> <strong>tfjob-random</strong></p>
<pre><code class="language-console">kubectl -n kubeflow get experiment tfjob-random -o json
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
<pre><code class="language-json">{
    &quot;apiVersion&quot;: &quot;kubeflow.org/v1alpha3&quot;,
    &quot;kind&quot;: &quot;Experiment&quot;,
    &quot;metadata&quot;: {
        &quot;annotations&quot;: {
            &quot;kubectl.kubernetes.io/last-applied-configuration&quot;: &quot;{\&quot;apiVersion\&quot;:\&quot;kubeflow.org/v1alpha3\&quot;,\&quot;kind\&quot;:\&quot;Experiment\&quot;,\&quot;metadata\&quot;:{\&quot;annotations\&quot;:{},\&quot;name\&quot;:\&quot;tfjob-random\&quot;,\&quot;namespace\&quot;:\&quot;kubeflow\&quot;},\&quot;spec\&quot;:{\&quot;algorithm\&quot;:{\&quot;algorithmName\&quot;:\&quot;random\&quot;},\&quot;maxFailedTrialCount\&quot;:3,\&quot;maxTrialCount\&quot;:12,\&quot;metricsCollectorSpec\&quot;:{\&quot;collector\&quot;:{\&quot;kind\&quot;:\&quot;TensorFlowEvent\&quot;},\&quot;source\&quot;:{\&quot;fileSystemPath\&quot;:{\&quot;kind\&quot;:\&quot;Directory\&quot;,\&quot;path\&quot;:\&quot;/train\&quot;}}},\&quot;objective\&quot;:{\&quot;goal\&quot;:0.99,\&quot;objectiveMetricName\&quot;:\&quot;accuracy_1\&quot;,\&quot;type\&quot;:\&quot;maximize\&quot;},\&quot;parallelTrialCount\&quot;:3,\&quot;parameters\&quot;:[{\&quot;feasibleSpace\&quot;:{\&quot;max\&quot;:\&quot;0.05\&quot;,\&quot;min\&quot;:\&quot;0.01\&quot;},\&quot;name\&quot;:\&quot;--learning_rate\&quot;,\&quot;parameterType\&quot;:\&quot;double\&quot;},{\&quot;feasibleSpace\&quot;:{\&quot;max\&quot;:\&quot;200\&quot;,\&quot;min\&quot;:\&quot;100\&quot;},\&quot;name\&quot;:\&quot;--batch_size\&quot;,\&quot;parameterType\&quot;:\&quot;int\&quot;}],\&quot;trialTemplate\&quot;:{\&quot;goTemplate\&quot;:{\&quot;rawTemplate\&quot;:\&quot;apiVersion: \\\&quot;kubeflow.org/v1\\\&quot;\\nkind: TFJob\\nmetadata:\\n  name: {{.Trial}}\\n  namespace: {{.NameSpace}}\\nspec:\\n tfReplicaSpecs:\\n  Worker:\\n    replicas: 1 \\n    restartPolicy: OnFailure\\n    template:\\n      spec:\\n        containers:\\n          - name: tensorflow \\n            image: gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0\\n            imagePullPolicy: IfNotPresent\\n            command:\\n              - \\\&quot;python\\\&quot;\\n              - \\\&quot;/var/tf_mnist/mnist_with_summaries.py\\\&quot;\\n              - \\\&quot;--log_dir=/train/metrics\\\&quot;\\n              {{- with .HyperParameters}}\\n              {{- range .}}\\n              - \\\&quot;{{.Name}}={{.Value}}\\\&quot;\\n              {{- end}}\\n              {{- end}}\&quot;}}}}\n&quot;
        },
        &quot;creationTimestamp&quot;: &quot;2019-10-27T02:46:02Z&quot;,
        &quot;finalizers&quot;: [
            &quot;update-prometheus-metrics&quot;
        ],
        &quot;generation&quot;: 2,
        &quot;name&quot;: &quot;tfjob-random&quot;,
        &quot;namespace&quot;: &quot;kubeflow&quot;,
        &quot;resourceVersion&quot;: &quot;21979&quot;,
        &quot;selfLink&quot;: &quot;/apis/kubeflow.org/v1alpha3/namespaces/kubeflow/experiments/tfjob-random&quot;,
        &quot;uid&quot;: &quot;e9f888cb-f863-11e9-88ef-080027c5bc64&quot;
    },
    &quot;spec&quot;: {
        &quot;algorithm&quot;: {
            &quot;algorithmName&quot;: &quot;random&quot;,
            &quot;algorithmSettings&quot;: null
        },
        &quot;maxFailedTrialCount&quot;: 3,
        &quot;maxTrialCount&quot;: 12,
        &quot;metricsCollectorSpec&quot;: {
            &quot;collector&quot;: {
                &quot;kind&quot;: &quot;TensorFlowEvent&quot;
            },
            &quot;source&quot;: {
                &quot;fileSystemPath&quot;: {
                    &quot;kind&quot;: &quot;Directory&quot;,
                    &quot;path&quot;: &quot;/train&quot;
                }
            }
        },
        &quot;objective&quot;: {
            &quot;goal&quot;: 0.99,
            &quot;objectiveMetricName&quot;: &quot;accuracy_1&quot;,
            &quot;type&quot;: &quot;maximize&quot;
        },
        &quot;parallelTrialCount&quot;: 3,
        &quot;parameters&quot;: [
            {
                &quot;feasibleSpace&quot;: {
                    &quot;max&quot;: &quot;0.05&quot;,
                    &quot;min&quot;: &quot;0.01&quot;
                },
                &quot;name&quot;: &quot;--learning_rate&quot;,
                &quot;parameterType&quot;: &quot;double&quot;
            },
            {
                &quot;feasibleSpace&quot;: {
                    &quot;max&quot;: &quot;200&quot;,
                    &quot;min&quot;: &quot;100&quot;
                },
                &quot;name&quot;: &quot;--batch_size&quot;,
                &quot;parameterType&quot;: &quot;int&quot;
            }
        ],
        &quot;trialTemplate&quot;: {
            &quot;goTemplate&quot;: {
                &quot;rawTemplate&quot;: &quot;apiVersion: \&quot;kubeflow.org/v1\&quot;\nkind: TFJob\nmetadata:\n  name: {{.Trial}}\n  namespace: {{.NameSpace}}\nspec:\n tfReplicaSpecs:\n  Worker:\n    replicas: 1 \n    restartPolicy: OnFailure\n    template:\n      spec:\n        containers:\n          - name: tensorflow \n            image: gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0\n            imagePullPolicy: IfNotPresent\n            command:\n              - \&quot;python\&quot;\n              - \&quot;/var/tf_mnist/mnist_with_summaries.py\&quot;\n              - \&quot;--log_dir=/train/metrics\&quot;\n              {{- with .HyperParameters}}\n              {{- range .}}\n              - \&quot;{{.Name}}={{.Value}}\&quot;\n              {{- end}}\n              {{- end}}&quot;
            }
        }
    },
    &quot;status&quot;: {
        &quot;completionTime&quot;: null,
        &quot;conditions&quot;: [
            {
                &quot;lastTransitionTime&quot;: &quot;2019-10-27T02:46:02Z&quot;,
                &quot;lastUpdateTime&quot;: &quot;2019-10-27T02:46:02Z&quot;,
                &quot;message&quot;: &quot;Experiment is created&quot;,
                &quot;reason&quot;: &quot;ExperimentCreated&quot;,
                &quot;status&quot;: &quot;True&quot;,
                &quot;type&quot;: &quot;Created&quot;
            }
        ],
        &quot;currentOptimalTrial&quot;: {
            &quot;observation&quot;: {
                &quot;metrics&quot;: null
            },
            &quot;parameterAssignments&quot;: null
        },
        &quot;startTime&quot;: &quot;2019-10-27T02:46:02Z&quot;
    }
}
</code></pre>
</details>
<p>Under the hood, Katib controller is looping in a reconcile loop to satisfy this <code>Experiment</code> request.</p>
<p><img src="../images/trials.png" alt="Trials" /></p>
<h3><a class="header" href="#suggestions" id="suggestions">Suggestions</a></h3>
<p>You can see Katib creating <code>Suggestions</code> using the <code>random</code> algorithm.</p>
<pre><code class="language-console">kubectl -n kubeflow  get suggestions tfjob-random -o yaml
</code></pre>
<details>
<summary>
 Sample Output - before suggestions are ready
 </summary>
<pre><code class="language-yaml">apiVersion: kubeflow.org/v1alpha3
kind: Suggestion
metadata:
  creationTimestamp: &quot;2019-10-27T02:57:58Z&quot;
  generation: 1
  name: tfjob-random
  namespace: kubeflow
  ownerReferences:
  - apiVersion: kubeflow.org/v1alpha3
    blockOwnerDeletion: true
    controller: true
    kind: Experiment
    name: tfjob-random
    uid: 94e07a51-f865-11e9-88ef-080027c5bc64
  resourceVersion: &quot;24296&quot;
  selfLink: /apis/kubeflow.org/v1alpha3/namespaces/kubeflow/suggestions/tfjob-random
  uid: 94e5930d-f865-11e9-88ef-080027c5bc64
spec:
  algorithmName: random
  requests: 3
status:
  conditions:
  - lastTransitionTime: &quot;2019-10-27T02:57:58Z&quot;
    lastUpdateTime: &quot;2019-10-27T02:57:58Z&quot;
    message: Suggestion is created
    reason: SuggestionCreated
    status: &quot;True&quot;
    type: Created
  - lastTransitionTime: &quot;2019-10-27T02:57:58Z&quot;
    lastUpdateTime: &quot;2019-10-27T02:57:58Z&quot;
    message: Deployment is not ready
    reason: DeploymentNotReady
    status: &quot;False&quot;
    type: DeploymentReady
  startTime: &quot;2019-10-27T02:57:58Z&quot;
</code></pre>
</details>
<p>We now have a <code>Suggestion</code> resource created. The Katib Suggestion Service takes control and generates a deployment to run the specified Suggestion.</p>
<p><img src="../images/suggestion.png" alt="Suggestion" />
The suggestion service provides suggestions based on the current state of the system. On each new suggestion request, it reevaluates and provides the next best set of suggestions.</p>
<details>
<summary>
 Sample Output - after suggestions are ready
 </summary>
<pre><code class="language-yaml">apiVersion: v1
items:
- apiVersion: kubeflow.org/v1alpha3
  kind: Suggestion
  metadata:
    creationTimestamp: &quot;2019-10-27T02:57:58Z&quot;
    generation: 10
    name: tfjob-random
    namespace: kubeflow
    ownerReferences:
    - apiVersion: kubeflow.org/v1alpha3
      blockOwnerDeletion: true
      controller: true
      kind: Experiment
      name: tfjob-random
      uid: 94e07a51-f865-11e9-88ef-080027c5bc64
    resourceVersion: &quot;25675&quot;
    selfLink: /apis/kubeflow.org/v1alpha3/namespaces/kubeflow/suggestions/tfjob-random
    uid: 94e5930d-f865-11e9-88ef-080027c5bc64
  spec:
    algorithmName: random
    requests: 12
  status:
    conditions:
    - lastTransitionTime: &quot;2019-10-27T02:57:58Z&quot;
      lastUpdateTime: &quot;2019-10-27T02:57:58Z&quot;
      message: Suggestion is created
      reason: SuggestionCreated
      status: &quot;True&quot;
      type: Created
    - lastTransitionTime: &quot;2019-10-27T02:58:16Z&quot;
      lastUpdateTime: &quot;2019-10-27T02:58:16Z&quot;
      message: Deployment is ready
      reason: DeploymentReady
      status: &quot;True&quot;
      type: DeploymentReady
    - lastTransitionTime: &quot;2019-10-27T02:59:16Z&quot;
      lastUpdateTime: &quot;2019-10-27T02:59:16Z&quot;
      message: Suggestion is running
      reason: SuggestionRunning
      status: &quot;True&quot;
      type: Running
    startTime: &quot;2019-10-27T02:57:58Z&quot;
    suggestionCount: 12
    suggestions:
    - name: tfjob-random-npjpbgmd
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.03684477847537918&quot;
      - name: --batch_size
        value: &quot;112&quot;
    - name: tfjob-random-mmc8dqvq
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.010960280128777096&quot;
      - name: --batch_size
        value: &quot;126&quot;
    - name: tfjob-random-6h7229dt
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.011672960430260329&quot;
      - name: --batch_size
        value: &quot;181&quot;
    - name: tfjob-random-hfzrfh8j
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.03510831325099869&quot;
      - name: --batch_size
        value: &quot;156&quot;
    - name: tfjob-random-7kg9zhrt
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.02709470325001432&quot;
      - name: --batch_size
        value: &quot;157&quot;
    - name: tfjob-random-gng5qx9x
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.021854230935173045&quot;
      - name: --batch_size
        value: &quot;148&quot;
    - name: tfjob-random-5sfxkhmc
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.011053371330636894&quot;
      - name: --batch_size
        value: &quot;131&quot;
    - name: tfjob-random-7bzhkvvd
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.039025808494984444&quot;
      - name: --batch_size
        value: &quot;139&quot;
    - name: tfjob-random-xjm458qc
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.023093126743054533&quot;
      - name: --batch_size
        value: &quot;105&quot;
    - name: tfjob-random-zb89h929
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.017877859019641958&quot;
      - name: --batch_size
        value: &quot;192&quot;
    - name: tfjob-random-wqglhpqj
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.018670804338535255&quot;
      - name: --batch_size
        value: &quot;191&quot;
    - name: tfjob-random-484zhpzq
      parameterAssignments:
      - name: --learning_rate
        value: &quot;0.029127223437729596&quot;
      - name: --batch_size
        value: &quot;133&quot;
</code></pre>
</details>
<h3><a class="header" href="#trials" id="trials">Trials</a></h3>
<p>Once the suggestions are ready, Katib Trail controller is ready to run the trials.
Each <code>Trial</code> evaluates the performance for the suggested hyperparameter vector and records the performance in the metric collector.</p>
<p><img src="../images/trials.png" alt="Suggestion" /></p>
<p>You can see Katib creating multiple <code>Trials</code>.</p>
<pre><code class="language-console">kubectl -n kubeflow get trials
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
<p>NAME                    TYPE      STATUS   AGE
tfjob-random-5xq64qwz   Created   True     25s
tfjob-random-h9l2h54d   Created   True     25s
tfjob-random-pf5htw5f   Created   True     25s</p>
</details>
<p>Each trial starts a <code>TFJob</code> resource. </p>
<pre><code class="language-console">kubectl -n kubeflow get tfjobs
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
<p>NAME                    TYPE      STATUS   AGE
tfjob-random-5xq64qwz   Created   True     25s
tfjob-random-h9l2h54d   Created   True     25s
tfjob-random-pf5htw5f   Created   True     25s</p>
</details>
<p>Each TFJob creates a <code>Worker</code> pod to run the trial.</p>
<pre><code class="language-console">kubectl -n kubeflow get po -l controller-name=tf-operator
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
<pre><code>NAME                             READY   STATUS    RESTARTS   AGE
tfjob-random-484zhpzq-worker-0   2/2     Running   0          39s
tfjob-random-wqglhpqj-worker-0   2/2     Running   0          40s
tfjob-random-zb89h929-worker-0   2/2     Running   0          41s
</code></pre>
</details>
<h3><a class="header" href="#metric-collection" id="metric-collection">Metric Collection</a></h3>
<p>When we talked about the Kubernetes architecture we briefly mentioned how a user creates resources using the Kubernetes API server and how the Kubernetes API server stores this data in etcd.</p>
<p><img src="../images/kubeapi-etcd.png" alt="kubeapi-etcd" /></p>
<p>In reality, there are several stages between the Kubernetes API server receiving a request before it is accepted.
In particular, there are two common extension points where external controllers can do additional tasks. These are mutating admission controllers and validating admission controllers.
Katib controller registers itself as both a mutating and validating controller.</p>
<p><img src="../images/katib-webhook.png" alt="katib-webhook" /></p>
<p>You can see the webhooks as follows.</p>
<pre><code class="language-console">kubectl get MutatingWebhookConfiguration
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
<pre><code>NAME                            CREATED AT
katib-mutating-webhook-config   2019-10-26T21:00:30Z
</code></pre>
</details>
<pre><code class="language-console">kubectl get ValidatingWebhookConfiguration
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
<pre><code>NAME                              CREATED AT
katib-validating-webhook-config   2019-10-26T21:00:30Z
</code></pre>
</details>
<p>The mutating webhook looks at Katib configuration and injects a side car container to the <code>Trial</code> jobs/pods. You can see the configurations as follows.</p>
<pre><code class="language-console">kubectl -n kubeflow get cm katib-config -o yaml
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
<pre><code class="language-yaml"> apiVersion: v1
data:
  metrics-collector-sidecar: |-
    {
      &quot;StdOut&quot;: {
              &quot;image&quot;: &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/file-metrics-collector:v0.7.0&quot;
      },
      &quot;File&quot;: {
              &quot;image&quot;: &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/file-metrics-collector:v0.7.0&quot;
      },
      &quot;TensorFlowEvent&quot;: {
              &quot;image&quot;: &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/tfevent-metrics-collector:v0.7.0&quot;
      }
    }
  suggestion: |-
    {
      &quot;random&quot;: {
              &quot;image&quot;: &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/suggestion-hyperopt:v0.7.0&quot;
      },
      &quot;grid&quot;: {
              &quot;image&quot;: &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/suggestion-chocolate:v0.7.0&quot;
      },
      &quot;hyperband&quot;: {
              &quot;image&quot;: &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/suggestion-hyperband:v0.7.0&quot;
      },
      &quot;bayesianoptimization&quot;: {
              &quot;image&quot;: &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/suggestion-skopt:v0.7.0&quot;
      },
      &quot;tpe&quot;: {
              &quot;image&quot;: &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/suggestion-hyperopt:v0.7.0&quot;
      },
      &quot;nasrl&quot;: {
              &quot;image&quot;: &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/suggestion-nasrl:v0.7.0&quot;
      }
    }
kind: ConfigMap
</code></pre>
</details>
<p>We can see the metrics-collector container injected into the TFJob worker pod.</p>
<pre><code class="language-console">kubectl -n kubeflow describe  po -l controller-name=tf-operator
</code></pre>
<details>
<summary>
Sample Output
</summary>
<pre><code class="language-yaml">Name:               tfjob-random-g4p7jx5b-worker-0
Namespace:          kubeflow
Priority:           0
PriorityClassName:  &lt;none&gt;
Node:               katib/10.0.2.15
Start Time:         Tue, 29 Oct 2019 18:37:20 +0000
Labels:             controller-name=tf-operator
                    group-name=kubeflow.org
                    job-name=tfjob-random-g4p7jx5b
                    job-role=master
                    tf-job-name=tfjob-random-g4p7jx5b
                    tf-replica-index=0
                    tf-replica-type=worker
Annotations:        &lt;none&gt;
Status:             Pending
IP:
Controlled By:      TFJob/tfjob-random-g4p7jx5b
Containers:
  tensorflow:
    Container ID:
    Image:         gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0
    Image ID:
    Port:          2222/TCP
    Host Port:     0/TCP
    Command:
      python
      /var/tf_mnist/mnist_with_summaries.py
      --log_dir=/train/metrics
      --learning_rate=0.044867652686667765
      --batch_size=179
    State:          Waiting
      Reason:       ContainerCreating
    Ready:          False
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /train from metrics-volume (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-mskhc (ro)
  metrics-collector:
    Container ID:
    Image:         gcr.io/kubeflow-images-public/katib/v1alpha3/tfevent-metrics-collector:v0.7.0
    Image ID:
    Port:          &lt;none&gt;
    Host Port:     &lt;none&gt;
    Args:
      -t
      tfjob-random-g4p7jx5b
      -m
      accuracy_1
      -s
      katib-manager.kubeflow:6789
      -path
      /train
    State:          Waiting
      Reason:       ContainerCreating
    Ready:          False
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /train from metrics-volume (rw)
Conditions:
  Type              Status
  Initialized       True
  Ready             False
  ContainersReady   False
  PodScheduled      True
Volumes:
  default-token-mskhc:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-mskhc
    Optional:    false
  metrics-volume:
    Type:        EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
    SizeLimit:   &lt;unset&gt;
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  4s    default-scheduler  Successfully assigned kubeflow/tfjob-random-g4p7jx5b-worker-0 to katib
  Normal  Pulled     2s    kubelet, katib     Container image &quot;gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0&quot; already present on machine
  Normal  Created    2s    kubelet, katib     Created container tensorflow
  Normal  Started    1s    kubelet, katib     Started container tensorflow
  Normal  Pulled     1s    kubelet, katib     Container image &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/tfevent-metrics-collector:v0.7.0&quot; already present on machine
  Normal  Created    1s    kubelet, katib     Created container metrics-collector
  Normal  Started    1s    kubelet, katib     Started container metrics-collector


Name:               tfjob-random-jcdvtfdf-worker-0
Namespace:          kubeflow
Priority:           0
PriorityClassName:  &lt;none&gt;
Node:               katib/10.0.2.15
Start Time:         Tue, 29 Oct 2019 18:35:44 +0000
Labels:             controller-name=tf-operator
                    group-name=kubeflow.org
                    job-name=tfjob-random-jcdvtfdf
                    job-role=master
                    tf-job-name=tfjob-random-jcdvtfdf
                    tf-replica-index=0
                    tf-replica-type=worker
Annotations:        &lt;none&gt;
Status:             Running
IP:                 192.168.0.231
Controlled By:      TFJob/tfjob-random-jcdvtfdf
Containers:
  tensorflow:
    Container ID:  docker://2792566751a57a6ab804621a9ec8b56e29ced44ddaceb6e395cd4fb8d7b0f7d6
    Image:         gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0
    Image ID:      docker-pullable://gcr.io/kubeflow-ci/tf-mnist-with-summaries@sha256:5c3181c3a97bc6f88fab204d4ac19ea12413b192953e21dc0ed07e7b821ddbe2
    Port:          2222/TCP
    Host Port:     0/TCP
    Command:
      python
      /var/tf_mnist/mnist_with_summaries.py
      --log_dir=/train/metrics
      --learning_rate=0.025430765523205827
      --batch_size=140
    State:          Running
      Started:      Tue, 29 Oct 2019 18:35:46 +0000
    Ready:          True
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /train from metrics-volume (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-mskhc (ro)
  metrics-collector:
    Container ID:  docker://4109a92753bdfddb2aa9dd4f866fcddb068016e2a65b24a321ac0ac832fac48f
    Image:         gcr.io/kubeflow-images-public/katib/v1alpha3/tfevent-metrics-collector:v0.7.0
    Image ID:      docker-pullable://gcr.io/kubeflow-images-public/katib/v1alpha3/tfevent-metrics-collector@sha256:d7c8fa8147f99ebb563c4d59fc6c333f96684f1598cce2f7eae629a878671656
    Port:          &lt;none&gt;
    Host Port:     &lt;none&gt;
    Args:
      -t
      tfjob-random-jcdvtfdf
      -m
      accuracy_1
      -s
      katib-manager.kubeflow:6789
      -path
      /train
    State:          Running
      Started:      Tue, 29 Oct 2019 18:35:46 +0000
    Ready:          True
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /train from metrics-volume (rw)
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  default-token-mskhc:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-mskhc
    Optional:    false
  metrics-volume:
    Type:        EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
    SizeLimit:   &lt;unset&gt;
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  99s   default-scheduler  Successfully assigned kubeflow/tfjob-random-jcdvtfdf-worker-0 to katib
  Normal  Pulled     97s   kubelet, katib     Container image &quot;gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0&quot; already present on machine
  Normal  Created    97s   kubelet, katib     Created container tensorflow
  Normal  Started    97s   kubelet, katib     Started container tensorflow
  Normal  Pulled     97s   kubelet, katib     Container image &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/tfevent-metrics-collector:v0.7.0&quot; already present on machine
  Normal  Created    97s   kubelet, katib     Created container metrics-collector
  Normal  Started    97s   kubelet, katib     Started container metrics-collector


Name:               tfjob-random-r66tzmjr-worker-0
Namespace:          kubeflow
Priority:           0
PriorityClassName:  &lt;none&gt;
Node:               katib/10.0.2.15
Start Time:         Tue, 29 Oct 2019 18:35:43 +0000
Labels:             controller-name=tf-operator
                    group-name=kubeflow.org
                    job-name=tfjob-random-r66tzmjr
                    job-role=master
                    tf-job-name=tfjob-random-r66tzmjr
                    tf-replica-index=0
                    tf-replica-type=worker
Annotations:        &lt;none&gt;
Status:             Running
IP:                 192.168.0.230
Controlled By:      TFJob/tfjob-random-r66tzmjr
Containers:
  tensorflow:
    Container ID:  docker://b3836fc16b83e82b3c3cad90472eeb079762f320270c834038d4a58f845f45b1
    Image:         gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0
    Image ID:      docker-pullable://gcr.io/kubeflow-ci/tf-mnist-with-summaries@sha256:5c3181c3a97bc6f88fab204d4ac19ea12413b192953e21dc0ed07e7b821ddbe2
    Port:          2222/TCP
    Host Port:     0/TCP
    Command:
      python
      /var/tf_mnist/mnist_with_summaries.py
      --log_dir=/train/metrics
      --learning_rate=0.04503686583590331
      --batch_size=120
    State:          Running
      Started:      Tue, 29 Oct 2019 18:35:45 +0000
    Ready:          True
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /train from metrics-volume (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-mskhc (ro)
  metrics-collector:
    Container ID:  docker://a94b366df6c6e3e318be7b9a72e92c26e988167338aacae68498ef68662eb619
    Image:         gcr.io/kubeflow-images-public/katib/v1alpha3/tfevent-metrics-collector:v0.7.0
    Image ID:      docker-pullable://gcr.io/kubeflow-images-public/katib/v1alpha3/tfevent-metrics-collector@sha256:d7c8fa8147f99ebb563c4d59fc6c333f96684f1598cce2f7eae629a878671656
    Port:          &lt;none&gt;
    Host Port:     &lt;none&gt;
    Args:
      -t
      tfjob-random-r66tzmjr
      -m
      accuracy_1
      -s
      katib-manager.kubeflow:6789
      -path
      /train
    State:          Running
      Started:      Tue, 29 Oct 2019 18:35:45 +0000
    Ready:          True
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /train from metrics-volume (rw)
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  default-token-mskhc:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-mskhc
    Optional:    false
  metrics-volume:
    Type:        EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
    SizeLimit:   &lt;unset&gt;
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  100s  default-scheduler  Successfully assigned kubeflow/tfjob-random-r66tzmjr-worker-0 to katib
  Normal  Pulled     99s   kubelet, katib     Container image &quot;gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0&quot; already present on machine
  Normal  Created    99s   kubelet, katib     Created container tensorflow
  Normal  Started    98s   kubelet, katib     Started container tensorflow
  Normal  Pulled     98s   kubelet, katib     Container image &quot;gcr.io/kubeflow-images-public/katib/v1alpha3/tfevent-metrics-collector:v0.7.0&quot; already present on machine
  Normal  Created    98s   kubelet, katib     Created container metrics-collector
  Normal  Started    98s   kubelet, katib     Started container metrics-collector
</code></pre>
</details>
<h3><a class="header" href="#experiment-completion" id="experiment-completion">Experiment Completion</a></h3>
<p>Once the Trials created by Katib are complete, the Experiment enters a completed state.
Check the completion status of the <code>Experiment</code> <strong>tfjob-random</strong></p>
<pre><code class="language-console">kubectl -n kubeflow get experiment tfjob-random -o json
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
</details>
<p>You can observe the status of this experiment under the <code>status</code> field of the output.</p>
<p>You can also see that Katib has cleaned up the <code>Trial</code> worker pods.</p>
<pre><code class="language-console">kubectl -n kubeflow get pods
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
<pre><code> NAME                                    READY   STATUS    RESTARTS   AGE
katib-controller-7665868558-nfghw       1/1     Running   1          21m
katib-db-594756f779-dxttq               1/1     Running   0          21m
katib-manager-769b7bcbfb-7vvgx          1/1     Running   0          21m
katib-ui-854969c97-tl4wg                1/1     Running   0          21m
pytorch-operator-794899d49b-ww59g       1/1     Running   0          21m
tf-job-operator-7b589f5f5f-fpr2p        1/1     Running   0          21m
tfjob-example-random-6d68b59ccd-fcn8f   1/1     Running   0          15m
</code></pre>
</details>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../katib/hptuning.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../katib/grid.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../katib/hptuning.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../katib/grid.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
