<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Grid Search - Hyperparameter tuning for TensorFlow using Katib and Kubeflow</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li><a href="../prereqs/prereqs.html"><strong aria-hidden="true">1.</strong> Setup Prerequisites</a></li><li><ol class="section"><li><a href="../prereqs/vagrant.html"><strong aria-hidden="true">1.1.</strong> Install Vagrant</a></li><li><a href="../prereqs/vb.html"><strong aria-hidden="true">1.2.</strong> Install Virtualbox</a></li><li><a href="../prereqs/download.html"><strong aria-hidden="true">1.3.</strong> Download Virtualbox VM</a></li></ol></li><li><a href="../kubernetes/setup.html"><strong aria-hidden="true">2.</strong> Setup Kubernetes</a></li><li><ol class="section"><li><a href="../kubernetes/k8s.html"><strong aria-hidden="true">2.1.</strong> Configure Persistent Storage</a></li><li><a href="../kubernetes/architecture.html"><strong aria-hidden="true">2.2.</strong> Kubernetes Architecture</a></li></ol></li><li><a href="../katib/katib.html"><strong aria-hidden="true">3.</strong> Katib</a></li><li><ol class="section"><li><a href="../katib/install.html"><strong aria-hidden="true">3.1.</strong> Installation</a></li><li><a href="../katib/hptuning.html"><strong aria-hidden="true">3.2.</strong> Hyperparameter Tuning</a></li><li><ol class="section"><li><a href="../katib/random.html"><strong aria-hidden="true">3.2.1.</strong> Random Search</a></li><li><a href="../katib/grid.html" class="active"><strong aria-hidden="true">3.2.2.</strong> Grid Search</a></li><li><a href="../katib/bayesian.html"><strong aria-hidden="true">3.2.3.</strong> Bayesian Optimization</a></li></ol></li><li><a href="../katib/automl.html"><strong aria-hidden="true">3.3.</strong> (Optional) AutoML Intuition</a></li></ol></li><li><a href="../kubeflow/kubeflow.html"><strong aria-hidden="true">4.</strong> Kubeflow</a></li><li><ol class="section"><li><a href="../kubeflow/instll.html"><strong aria-hidden="true">4.1.</strong> Installation</a></li></ol></li><li><a href="../cleanup/cleanup.html"><strong aria-hidden="true">5.</strong> Cleanup</a></li><li><a href="../references/index.html"><strong aria-hidden="true">6.</strong> References</a></li><li class="spacer"></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Hyperparameter tuning for TensorFlow using Katib and Kubeflow</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#grid-search" id="grid-search">Grid Search</a></h1>
<p>Grid search is also a black box algorithm similar to Random search. 
It assumes nothing about the model and each trial can be run in parallel.</p>
<p>Grid search does an exhaustive search over the entire search space. 
Ideally you want the search to be uniform across your entire search space. 
The following picture shows an example search with step size 10 for the batch size.</p>
<p><img src="../images/grid.png" alt="Grid" /></p>
<p>However depending on the search space and the parameters you chose, the grid algorithm may end up not covering a lot of ground in one hyperparameter space. For example for the same example above, if you choose a step size of 3 instead of 10, you get the following coverage in 30 iterations.</p>
<p><img src="../images/grid-bad.png" alt="Grid" /></p>
<p>So if you want a generic baseline, it is always a good idea to start with a Random search.</p>
<p>Now let us create a grid search experiment using Katib.</p>
<h3><a class="header" href="#experiment" id="experiment">Experiment</a></h3>
<p>Let us start by creating an experiment.</p>
<details>
<summary>
Grid search experiment
</summary>
<pre><code class="language-yaml">apiVersion: &quot;kubeflow.org/v1alpha3&quot;
kind: Experiment
metadata:
  namespace: kubeflow
  name: tfjob-grid
spec:
  parallelTrialCount: 3
  maxTrialCount: 12
  maxFailedTrialCount: 3
  objective:
    type: maximize
    goal: 0.99
    objectiveMetricName: accuracy_1
  algorithm:
    algorithmName: grid
  metricsCollectorSpec:
    source:
      fileSystemPath:
        path: /train
        kind: Directory
    collector:
      kind: TensorFlowEvent
  parameters:
    - name: --learning_rate
      parameterType: double
      feasibleSpace:
        min: &quot;0.01&quot;
        max: &quot;0.05&quot;
        step: &quot;0.001&quot;
    - name: --batch_size
      parameterType: int
      feasibleSpace:
        min: &quot;100&quot;
        max: &quot;200&quot;
        step: &quot;20&quot;
  trialTemplate:
    goTemplate:
        rawTemplate: |-
          apiVersion: &quot;kubeflow.org/v1&quot;
          kind: TFJob
          metadata:
            name: {{.Trial}}
            namespace: {{.NameSpace}}
          spec:
           tfReplicaSpecs:
            Worker:
              replicas: 1
              restartPolicy: OnFailure
              template:
                spec:
                  containers:
                    - name: tensorflow
                      image: gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0
                      imagePullPolicy: IfNotPresent
                      command:
                        - &quot;python&quot;
                        - &quot;/var/tf_mnist/mnist_with_summaries.py&quot;
                        - &quot;--log_dir=/train/metrics&quot;
                        {{- with .HyperParameters}}
                        {{- range .}}
                        - &quot;{{.Name}}={{.Value}}&quot;
                        {{- end}}
                        {{- end}}
</code></pre>
</details>
<p>There are two changes in this yaml compared to the random search. First we set <code>algorithmName: grid</code> instead of <code>algorithmName: random</code>. Second we set the step sizes using <code>step: &quot;0.001&quot;</code> and <code>step: &quot;20&quot;</code>.</p>
<p>Create this experiment as follows.</p>
<pre><code class="language-console">cd $HOME/tutorial/examples/v1alpha3
kubectl apply -f tfjob-grid.yaml
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
<p>experiment.kubeflow.org/tfjob-grid created</p>
</details>
<p>Check that the <code>Experiment</code> <strong>tfjob-grid</strong> has started.</p>
<pre><code class="language-console">kubectl -n kubeflow get experiment
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
NAME            STATUS    AGE
tfjob-grid   Running   98s
</details>
<p>Check the details of the <code>Experiment</code> <strong>tfjob-grid</strong></p>
<pre><code class="language-console">kubectl -n kubeflow get experiment tfjob-grid -o yaml
</code></pre>
<details>
<summary>
 Sample Output
 </summary>
<pre><code class="language-yaml">apiVersion: kubeflow.org/v1alpha3
kind: Experiment
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {&quot;apiVersion&quot;:&quot;kubeflow.org/v1alpha3&quot;,&quot;kind&quot;:&quot;Experiment&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;tfjob-grid&quot;,&quot;namespace&quot;:&quot;kubeflow&quot;},&quot;spec&quot;:{&quot;algorithm&quot;:{&quot;algorithmName&quot;:&quot;grid&quot;},&quot;maxFailedTrialCount&quot;:3,&quot;maxTrialCount&quot;:12,&quot;metricsCollectorSpec&quot;:{&quot;collector&quot;:{&quot;kind&quot;:&quot;TensorFlowEvent&quot;},&quot;source&quot;:{&quot;fileSystemPath&quot;:{&quot;kind&quot;:&quot;Directory&quot;,&quot;path&quot;:&quot;/train&quot;}}},&quot;objective&quot;:{&quot;goal&quot;:0.99,&quot;objectiveMetricName&quot;:&quot;accuracy_1&quot;,&quot;type&quot;:&quot;maximize&quot;},&quot;parallelTrialCount&quot;:3,&quot;parameters&quot;:[{&quot;feasibleSpace&quot;:{&quot;max&quot;:&quot;0.05&quot;,&quot;min&quot;:&quot;0.01&quot;,&quot;step&quot;:&quot;0.001&quot;},&quot;name&quot;:&quot;--learning_rate&quot;,&quot;parameterType&quot;:&quot;double&quot;},{&quot;feasibleSpace&quot;:{&quot;max&quot;:&quot;200&quot;,&quot;min&quot;:&quot;100&quot;,&quot;step&quot;:&quot;1&quot;},&quot;name&quot;:&quot;--batch_size&quot;,&quot;parameterType&quot;:&quot;int&quot;}],&quot;trialTemplate&quot;:{&quot;goTemplate&quot;:{&quot;rawTemplate&quot;:&quot;apiVersion: \&quot;kubeflow.org/v1\&quot;\nkind: TFJob\nmetadata:\n  name: {{.Trial}}\n  namespace: {{.NameSpace}}\nspec:\n tfReplicaSpecs:\n  Worker:\n    replicas: 1 \n    restartPolicy: OnFailure\n    template:\n      spec:\n        containers:\n          - name: tensorflow \n            image: gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0\n            imagePullPolicy: IfNotPresent\n            command:\n              - \&quot;python\&quot;\n              - \&quot;/var/tf_mnist/mnist_with_summaries.py\&quot;\n              - \&quot;--log_dir=/train/metrics\&quot;\n              {{- with .HyperParameters}}\n              {{- range .}}\n              - \&quot;{{.Name}}={{.Value}}\&quot;\n              {{- end}}\n              {{- end}}&quot;}}}}
  creationTimestamp: &quot;2019-10-27T17:32:38Z&quot;
  finalizers:
  - update-prometheus-metrics
  generation: 2
  name: tfjob-grid
  namespace: kubeflow
  resourceVersion: &quot;153550&quot;
  selfLink: /apis/kubeflow.org/v1alpha3/namespaces/kubeflow/experiments/tfjob-grid
  uid: c5934b51-f8df-11e9-88ef-080027c5bc64
spec:
  algorithm:
    algorithmName: grid
    algorithmSettings: null
  maxFailedTrialCount: 3
  maxTrialCount: 12
  metricsCollectorSpec:
    collector:
      kind: TensorFlowEvent
    source:
      fileSystemPath:
        kind: Directory
        path: /train
  objective:
    goal: 0.99
    objectiveMetricName: accuracy_1
    type: maximize
  parallelTrialCount: 3
  parameters:
  - feasibleSpace:
      max: &quot;0.05&quot;
      min: &quot;0.01&quot;
      step: &quot;0.001&quot;
    name: --learning_rate
    parameterType: double
  - feasibleSpace:
      max: &quot;200&quot;
      min: &quot;100&quot;
      step: &quot;1&quot;
    name: --batch_size
    parameterType: int
  trialTemplate:
    goTemplate:
      rawTemplate: &quot;apiVersion: \&quot;kubeflow.org/v1\&quot;\nkind: TFJob\nmetadata:\n  name:
        {{.Trial}}\n  namespace: {{.NameSpace}}\nspec:\n tfReplicaSpecs:\n  Worker:\n
        \   replicas: 1 \n    restartPolicy: OnFailure\n    template:\n      spec:\n
        \       containers:\n          - name: tensorflow \n            image: gcr.io/kubeflow-ci/tf-mnist-with-summaries:1.0\n
        \           imagePullPolicy: IfNotPresent\n            command:\n              -
        \&quot;python\&quot;\n              - \&quot;/var/tf_mnist/mnist_with_summaries.py\&quot;\n              -
        \&quot;--log_dir=/train/metrics\&quot;\n              {{- with .HyperParameters}}\n
        \             {{- range .}}\n              - \&quot;{{.Name}}={{.Value}}\&quot;\n              {{-
        end}}\n              {{- end}}&quot;
status:
  completionTime: &quot;2019-10-27T17:42:37Z&quot;
  conditions:
  - lastTransitionTime: &quot;2019-10-27T17:32:38Z&quot;
    lastUpdateTime: &quot;2019-10-27T17:32:38Z&quot;
    message: Experiment is created
    reason: ExperimentCreated
    status: &quot;True&quot;
    type: Created
  - lastTransitionTime: &quot;2019-10-27T17:42:37Z&quot;
    lastUpdateTime: &quot;2019-10-27T17:42:37Z&quot;
    message: Experiment is running
    reason: ExperimentRunning
    status: &quot;False&quot;
    type: Running
  - lastTransitionTime: &quot;2019-10-27T17:42:37Z&quot;
    lastUpdateTime: &quot;2019-10-27T17:42:37Z&quot;
    message: Experiment has succeeded because max trial count has reached
    reason: ExperimentSucceeded
    status: &quot;True&quot;
    type: Succeeded
  currentOptimalTrial:
    observation:
      metrics:
      - name: accuracy_1
        value: 0.970499992371
    parameterAssignments:
    - name: --learning_rate
      value: &quot;0.01&quot;
    - name: --batch_size
      value: &quot;110&quot;
  startTime: &quot;2019-10-27T17:32:38Z&quot;
  trials: 12
  trialsSucceeded: 12
</code></pre>
</details>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../katib/random.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../katib/bayesian.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../katib/random.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../katib/bayesian.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
